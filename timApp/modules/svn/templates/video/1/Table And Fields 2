Table And Fields 2
Plugins for one specific task
\

#- {defaultplugin="textfield" .fieldCell}
%% 'XX_Riitauta=Riitauta: Kirjoita tähän, jos et tykkää arvioista' | gfields('cols: 25') -%%
\
#- {area="XX_demo" visible="%% False | isview%%" nocache="true"}
Tehtävä: XX
#- {area="XX_fields" collapse="true"}
Arviointitilanne

#- {defaultplugin="numericfield" readonly="view" .fieldCell}
%% 'XX_Pisteet=Pisteet;XX_Ope=Ope;XX_Arviointi=Arviointi' | gfields('cols: 5') -%%
\
#- {defaultplugin="textfield" readonly="view" .fieldCell}
Tehtävän arvioineet:\
{%for i in range(0, arvosteltavia)%}
{#XX_Arvioija_%%i+1%% stem: Arvioija %%i+1%%, cols: 10 #}
{#XX_P_%%i+1%% stem: P, cols: 2 #}
{% endfor -%}
\
#- {defaultplugin="textfield" readonly="view" .fieldCell}
%% 'XX_Riita=Riita' | gfields('cols: 5') -%%
\
#- {area_end="XX_fields"}
#- {area_end="XX_demo"}
\
``` {#XX_demotable plugin="tableForm" visible="%% False | isview%%" nocache="true"}
groups:
 - %%group%%
fields:
 - XX_Arviointi=Arviointi
 - XX_Ope=Ope
 - XX_Pisteet=Pisteet
{% for i in range(1,arvosteltavia+1) %}
 - XX_Arvioija_%%i%%=Arvioija%%i%%=Arvioija_%%i%%
 - XX_P_%%i%%=P%%i%%=P_%%i%%
{% endfor %}
 - XX_Riita=Riita
 - XX_Riitauta=Riitauta
header: Demotaulukko
minWidth: 3em
singleLine: true
open: false
hideButtonText: Piilota taulukko
emailUsersButtonText: Lähetä ruksituille sähköpostia
emailUsersButtonText: "Lähetä sähköpostia"
```
\
``` {#XX_runnerVari plugin="jsrunner"}
groups:
 - %%group%%
buttonText: Päivitä tilanne
fields:
 - XX_Ope
 - XX_Pisteet
 - XX_Arviointi
 - XX_Arvioija_(1,%%arvosteltavia%%)
 - XX_P_(1,%%arvosteltavia%%)
 - XX_Riitauta
updateFields:
 - XX_Ope
 - XX_Pisteet
 - XX_Arviointi
 - XX_Arvioija_(1,%%arvosteltavia%%)
 - XX_P_(1,%%arvosteltavia%%)
 - XX_Riitauta
program: |!!

    arviotLkm = tools.getReviewCountTest("XX") // Opiskelijan tekemien arvioiden lkm
    hyvitys = 1 // Arvioinnista saatu hyvityspiste
    tools.setDouble("XX_Arviointi", arviotLkm * hyvitys)

    pisteet = tools.getTaskPointsTest("XX") // Keskiarvo vertaisarviointien pistemääristä
    ope = tools.getDouble("XX_Ope", -100) //Opettajan tekemä korjaus pisteytykseen
    if (ope != -100) {
        tools.setDouble("XX_Pisteet", ope)
    }
    else {
        tools.setString("XX_Pisteet", pisteet)
    }
    pointsArray = []
    arvioinnit = tools.getReviewsTest("XX")
    for (let i =1; i <= arvioinnit.length; i++) {
        tools.setString("XX_Arvioija_${i}"+i, arvioinnit[i-1].name)
        points = arvioinnit[i-1].points
        totalPoints = 0
        for (let j=0; j<points.length; j++) {
            totalPoints += points[j]
        }
        avg = totalPoints / points.length
        tools.setString("XX_P_"+i, avg)

        pointsArray.push(avg)
        max = Math.max(...pointsArray)
        min = Math.min(...pointsArray)
        delta = max - min
        value = 0 // Suurin sallittu ero pisteiden välillä
        if (delta >= value && pointsArray.length > 1 ) {
            tools.setDouble("XX_Riita", delta)
            tools.setString("XX_Riita.styles", '{"backgroundColor": "red"}')
        }
    }
!!
```
\
