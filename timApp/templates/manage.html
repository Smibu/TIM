{% extends obj_name + ".html" %}
{% set is_folder = obj_name == 'folder' %}
{% block title %}{{ doc.name }} - Manage{% endblock %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='scripts/manageView/manageCtrl.js') }}"></script>

    <style type="text/css">
        table {
            margin: 1em;
        }

        thead {
            font-weight: bold;
        }

        table td {
            padding: 0.2em;
        }

        .flashes li {
            list-style-type: none;
            border: 1px solid black;
            border-radius: 3px;
            padding: 0.5em;
        }

        .uploadForm {
            border: 1px solid black;
            padding: 1em;
        }

        .material {
            padding: 1em;
        }

        .margin {
            margin-top: 1em;
            margin-bottom: 1em;
        }
    </style>
    <script>
        var isFolder = {{is_folder|tojson}};
        var doc = {{doc|tojson}};
        var grouprights = {{grouprights|tojson}};
        var accessTypes = {{access_types|tojson}};
        var groups = {{user_groups|tojson}};
    </script>
{% endblock %}
{% block content %}
    <div ng-controller="PermCtrl">
        {% if rights['owner'] %}
            <div class="margin">
                <form ng-submit="changeOwner()">
                    <label>{{ obj_name|capitalize }} owner: <input type="text" ng-model="newOwner"></label>
                    <button ng-disabled="doc.owner.name === newOwner" class="timButton">
                        Update
                    </button>
                    <span ng-show="ownerUpdating">Updating...</span>
                </form>
            </div>
        {% else %}
            {{ obj_name|capitalize }} owner: {{ doc.owner.name }}
        {% endif %}

        <div class="margin rights-list" ng-repeat="type in accessTypes">
            <a ng-click="showAddRightFn(type)">{{ '{{ type.name }}' }} right</a>:
            <span ng-show="filtered.length == 0">none</span>

            <ul>
                <li ng-repeat="group in filtered = (grouprights | filter: {access_type: type.id}:true)">{{ '{{group.name}}' }}
                    (<a ng-click="removeConfirm(group, type.name)">remove</a>)
                </li>
            </ul>
        </div>
        <div class="margin">
            <a ng-show="!showAddRight" ng-click="showAddRight = true; focusEditor = true">Add right</a>
            <div ng-show="showAddRight" class="rights-list">
                <form ng-submit="addPermission(groupName, accessType)">
                    <label>Right: <select ng-model="accessType"
                                          ng-options="access.name for access in accessTypes track by access.id"></select></label>
                    <label>name: <input type="text" ng-model="groupName" focus-me="focusEditor"
                                        placeholder='enter userid or group name'></label>
                    <button type="submit" ng-disabled="!groupName">Add</button>
                    <button type="button" ng-click="showAddRight = false">Cancel</button>

                    <button type="button" ng-click="addPermission('Korppi users', accessType)">Add Korppi users</button>
                    <button type="button" ng-click="addPermission('Logged-in users', accessType)">Add logged-in users
                    </button>
                    <button type="button" ng-click="addPermission('Anonymous users', accessType)">Add anonymous users
                    </button>

                </form>
            </div>
        </div>
    {% block managecontent %}{% endblock %}
    </div>
{% endblock %}
