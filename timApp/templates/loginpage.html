{% extends "base.html" %}
{% block title %}Login{% endblock %}
{% block content %}
    <script>
        $(document).ready(function () {
            var target_url = {{ url_for('login_page.login_with_korppi')|tojson }};
            var separator = target_url.indexOf('?') >= 0 ? '&' : '?';
            var came_from_raw = {{ (came_from or '')|tojson }};
            var came_from = encodeURIComponent(came_from_raw.replace("#", "%23"));
            var anchor_raw = {{ anchor|tojson if anchor else "window.location.hash.replace('#', '')"|safe }};
            var anchor = encodeURIComponent(anchor_raw);
            $("#anchor").val(anchor_raw);
            window.korppiLogin = function () {
                window.location.replace(target_url
                + separator
                + 'came_from='
                + came_from
                + '&anchor='
                + anchor);
            }
        });
    </script>

    <div class="row">
        <div class="col-sm-6 col-sm-offset-3">
            <form class="form-horizontal" method="POST" action="/altlogin">
                <p class="text-center">
                    {% if not hide_require_text %}
                        Login is required for this document.
                    {% endif %}
                    You can either login with Korppi
                </p>

                <button class="timButton center-block" type="button" onclick="korppiLogin()">Login with Korppi</button>
                <p class="text-center">
                    or with your email address if you have a TIM email account.
                </p>

                <input type="hidden" name="came_from" value="{{ came_from or '' }}">
                <input id="anchor" type="hidden" name="anchor" value="">

                <div class="form-group">
                    <label for="email" class="control-label col-sm-4">Email</label>
                    <div class="col-sm-6">
                        <input class="form-control" id="email" name="email" type="email" value="{{ session.email }}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="password" class="col-sm-4 control-label">Password</label>
                    <div class="col-sm-6">
                        <input class="form-control" id="password" name="password" type="password">
                    </div>
                </div>

                <button class="center-block timButton" type="submit">Login</button>
            </form>
        </div>
    </div>
{% endblock %}
