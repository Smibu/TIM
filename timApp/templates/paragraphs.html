{% set arealine = '<div class="arealine areacollapse" title="Click to collapse / expand"></div>' %}
{% set editline = '' %}
{% if rights.editable or rights.can_comment %}
    {% set editline = '<div class="editline" title="Click to edit this paragraph"></div>' %}
{% endif %}

{% if route == "view" and text|length == 0 and rights.editable %}
    <div class="par"
         id="null"
         t=""
         attrs="{}"
         ng-non-bindable>

        <div class="parContent">
            <p>Click left side to edit. You can get help with editing from editor's Help tab.</p>
            <p>This is an automatically added help paragraph. It will disappear when you add content.</p>
        </div>
        {{ editline|safe }}
    </div>
{% endif %}


{% for t in text %}
    <div class="{{ t.cls|trim}} {{ t.is_plugin|trim}}"
         id="{{ t.id }}"
         t="{{ t.t }}"
         attrs="{{ t.attrs_str }}"
     {% if t.attrs.area %}
         data-area-start="{{ t.attrs.area|safe }}"
     {% endif %}
     {% if area %}
         data-area="{{ area|safe }}"
     {% endif %}
     {% if t.ref_id %}
         ref-id="{{ t.ref_id }}"
         ref-t="{{ t.ref_t }}"
         ref-attrs="{{ t.ref_attrs_str }}"
         ref-doc-id="{{ t.ref_doc_id }}"
     {% endif %}
    {% if not t.is_plugin %}ng-non-bindable{% endif %}>
    {% if t.attrs.taskId %}
        <a href="#{{ t.attrs.taskId }}" title="Permlink" class="headerlink">#</a>
    {% endif %}
            {% if t.is_plugin and t.needs_browser %}
                    <answerbrowserlazy
                            task-id="{{ (t.ref_doc_id or t.doc_id) }}.{{ (t.ref_attrs or t.attrs)['taskId'] }}">
                    </answerbrowserlazy>
            {% endif %}
    <div class="parContent"{% if t.attrs.taskId %} id="{{ t.attrs.taskId }}"{% endif %}>
        {{ t.html|safe }}
    </div>

    {% if t.attrs.area_end == area %}
        {% set area = none %}
    {% endif %}

    {% if area %}
        <div class="areapartline"></div>
    {% elif t.attrs.area %}
        {{ arealine|safe }}
        {% set area = t.attrs.area %}
    {% endif %}

    {{ editline|safe }}
    <div class="{{ ['readline', t.status]|join(' ')|trim }}"
         title="Click to mark this paragraph as read"></div>
    {% if t.notes %}
        <div class="notes">
            {% for note in t.notes %}
                <div class="{{ ['note', 'editable' if note.editable else '', 'private' if note.private else '']|join(' ')|trim }}"
                     note-id="{{ note.id }}">
                    {{ note.html|safe }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    </div>
{% endfor %}