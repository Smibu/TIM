{% extends "folder.html" %}
{% block title %}{{'{} {}'.format(doc.name, '({})'.format(doc.location) if doc.location else '[root]') if doc else 'Root folder'}}{% endblock %}
{% block head %}
    {{ super() }}

    <script>
        var groups = {{userGroups|tojson}};
        var folder = "{{doc.fullname if doc else ''}}";
    </script>
    <script src="{{ url_for('static', filename='scripts/timApp.js') }}"></script>
{% endblock %}

{% set col_m_lg = 10 %}

{% block content %}
    <div ng-controller="IndexCtrl" class="index">
        <span ng-show="displayIndex">Welcome! Start by choosing a document to view: </span> <img
            src="{{ url_for('static', filename='images/loading.gif') }}" ng-show="!displayIndex">

        <div ng-show="displayIndex >= 2">
            <table class="table" ng-show="documentList.length > 0 || folderList.length > 0 || parentfolder != null">
                <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th></th>
                    <th>Last modified</th>
                    <th>Owner</th>
                    <th>Rights</th>
                </tr>
                </thead>
                <tr ng-show="parentfolder != null">
                    <td>
                        <a href="/view/{{ '{{ parentfolder | escape }}' }}">
                            <span class="glyphicon glyphicon-level-up" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td><a href="/view/{{ '{{ parentfolder | escape }}' }}">Go to parent folder</a></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr ng-repeat="doc in folderList">
                    <td>
                        <a href="/view/{{ '{{ doc.fullname | escape }}' }}">
                            <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>
                        </a>
                    </td>
                    <td>
                        <a href="/view/{{ '{{ doc.fullname | escape }}' }}">{{ '{{ doc.name }}' }}</a>
                    </td>
                    <td></td>
                    <td>{{ '{{ doc.modified }}' }}</td>
                    <td>{{ '{{ doc.owner.name }}' }}</td>
                    <td>
                        <a title="Manage" ng-show="doc.isOwner" href="/manage/{{ '{{ doc.id }}' }}" class="glyphicon glyphicon-cog"></a>
                    </td>
                </tr>
                <tr ng-repeat="doc in documentList">
                    <td></td>
                    <td>
                        <a href="/view/{{ '{{ doc.fullname | escape }}' }}">{{ '{{ doc.name }}' }}</a>
                    </td>
                    <td></td>
                    <td>{{ '{{ doc.modified }}' }}</td>
                    <td>{{ '{{ doc.owner.name }}' }}</td>
                    <td>
                        <a title="Edit" ng-show="doc.canEdit" href="/view/{{ '{{ doc.id }}' }}" class="glyphicon glyphicon-pencil"></a>
                        <a title="Manage" ng-show="doc.isOwner" href="/manage/{{ '{{ doc.id }}' }}" class="glyphicon glyphicon-cog"></a>
                        <a title="Teacher" ng-show="doc.isOwner" href="/teacher/{{ '{{ doc.fullname | escape }}' }}" class="glyphicon glyphicon-education"></a>
                    </td>
                </tr>
            </table>
            <p ng-show="documentList.length == 0 && folderList.length == 0">There are no documents to show.</p>
            {% if session.user_id %}
                <uib-tabset active="-1">
                    <uib-tab heading="Upload a new document">
                        <div class="form-group">
                            <label for="docUpload">Select a file:</label>
                            <input id="docUpload" class="form-control" type="file" ngf-select="onFileSelect($file)">
                        </div>
                     <span ng-show="file.progress >= 0"
                           ng-bind="file.progress < 100 ? 'Uploading... ' + file.progress + '%' : 'Done!'">
                     </span>
                    </uib-tab>
                    <uib-tab heading="Create a new document">
                        <div class="form-group"><label>
                            Document name:
                            <input class="form-control" ng-model="docName" type="text">
                        </label></div>
                        <button class="timButton" ng-disabled="!docName" ng-click="createDocument(docName)" type="button">Create
                        </button>
                    </uib-tab>
                    <uib-tab heading="Create a new folder">
                        <div class="form-group"><label>
                            Folder name:
                            <input class="form-control" ng-model="folderName" type="text">
                        </label></div>
                        <div class="form-group"><label>
                            Owner: <input class="form-control" type="text" ng-model="folderOwner">
                        </label></div>
                        <button class="timButton" ng-disabled="!folderName || !folderOwner"
                                ng-click="createFolder(folderName, folderOwner)" type="button">Create
                        </button>
                    </uib-tab>
                </uib-tabset>
            {% else %}
                To create or upload new documents, log in.
            {% endif %}
        </div>
    </div>
{% endblock %}
