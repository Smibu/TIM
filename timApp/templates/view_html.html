{% extends "base.html" %}
{% block title %}{{ docName }}{% endblock %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='scripts/checkModules.js') }}"></script>

    {% for script in js %}
        <script src=" {{ script }}"></script>
    {% endfor %}

    <script>

        var modules = checkModules([
            {% for dep in jsMods %}
                "{{ dep|safe}}",
            {% endfor %}
        ]);

    </script>

    <script src="{{ url_for('bower.static', filename='ace-builds/src-min-noconflict/ace.js') }}"></script>
    <script src="{{ url_for('bower.static', filename='angular-ui-ace/ui-ace.js') }}"></script>
    <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="{{ url_for('static', filename='scripts/view_html.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/pareditor.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/answerbrowser.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/notesView/contents.js') }}"></script>

    <!-- Script to load question from another file -->
    <script>
        $(function () {
            $("#question").load("../../question");
        });
    </script>

    <link rel="stylesheet" href="../../static/css/popUp.css">
    <link rel="stylesheet" href="../../static/css/style.css">



    {% for cssFile in cssFiles %}
        <link rel="stylesheet" href="{{ cssFile }}">
    {% endfor %}

    {% for cssFile in custom_css_files %}
        <link rel="stylesheet" href="{{ url_for('static', filename='css/' + cssFile + '.css') }}">
    {% endfor %}

    <style type="text/css">
        {{ custom_css }}
    </style>
    <script>
        var docId = JSON.parse({{docID|tojson|safe}});
        var docName = {{docName|tojson|safe}};
        var version = {{version|tojson|safe}};
        var canEdit = {{editable|tojson}};
        var startIndex = {{start_index|tojson}};
        var refererPath = {{request.path|tojson|safe}};
        {% if plugin_users %}
            var users = {{plugin_users|tojson}};
        {% else %}
            var users = [{{current_user|tojson}}];
        {% endif %}
    </script>

{% endblock %}
{% block content %}
    <div ng-app="timApp" class="paragraphs" ng-controller="ViewCtrl">
        <div id="contents" ng-show="indexTable.length > 0">
            <div class="menu">
                <img class="menu-icon" src="{{ url_for('static', filename='images/contents.png') }}" width="50"
                     height="50"/>
            </div>
            <div class="sidebar">
                {% raw %}
                <h1>{{docName}}</h1>
                <ul>
                    <span ng-repeat="entry in indexTable">
                        <li ng-class="entry.state"
                            ng-mouseup="entry.state = invertStateClearSelection($event, entry.state)">
                            <a class="indexentry" ng-class="entry.style" onclick="autoHide()" href="{{entry.target}}">{{entry.text}}</a>
                            <ul ng-show="entry.state == 'exp'">
                                <li ng-repeat="subentry in entry.items">
                                    <a ng-class="subentry.style" onclick="autoHide()" href="{{subentry.target}}">{{subentry.text}}</a>
                                </li>
                            </ul>
                        </li>
                    </span>
                </ul>

                {% endraw %}
            </div>
        </div>

        {% if plugin_users|length > 0 %}
            <div id="users" class="userlist">
                {% for user in plugin_users %}
                    <div>
                        <a class="userentry" href="?user={{ user.id }}" target="_self">{{ user.name|safe }}</a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div id="pars">
            {% for t in text %}
                <div class="par">
                    <div class="parContent">
                        {{ t['html']|safe }}
                    </div>
                    {% if 'task_id' in t %}
                        <answerbrowser
                                user="{{ current_user|e }}"
                                task-id="{{ t['task_id'] }}">
                        </answerbrowser>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <!-- Adding question to view. Hidden until creation of question-->
        <question-dialog show='questionShown'>
            <div ng-controller="QuestionController">

                <form class="basic-grey">
                    <fieldset>
                        <label>Kysymys:</label>
                        <input type="text" placeholder="Question" ng-model="question">
                        <br>
                        <label>Kysymystyyppi:</label>
                        <select name="tyyppi">
                            <option value="matriisi" selected>Matriisi</option>
                        </select><br>
                        <label>Vastaustyyppi:</label>
                        <select name="vtyyppi">
                            <option value="radiobutton" selected>Radiopainike</option>
                            <option value="vapaakenttä">Vapaakenttä</option>
                            <option value="checkbox">Checkbox</option>
                        </select><br><br>
                        <label>Vastausvaihtoehdot:</label><br>
                        <label>Vastausaika:</label>
                        <input type="radio" name="vastausaika" value="0">Ei
                        <input type="radio" name="vastausaika" value=""><input type=text" size="3">
                        </select>
                        <br><br>
                        <input type="button" class="button" value="Submit" ng-click="createQuestion('testi','vastaus')">
                    </fieldset>

                </form>

                <button ng-click="createQuestion(question, 'vastaus')"> Nappula</button>
            </div>
        </question-dialog>
    </div>


{% endblock %}
