{% extends "base.html" %}
{% block title %}{{ docName }}{% endblock %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='scripts/checkModules.js') }}"></script>

    {% if teacher_mode %}
        <script src="{{ url_for('bower.static', filename='ng-table/dist/ng-table.js') }}"></script>
        <script src="{{ url_for('bower.static', filename='ng-table-export/ng-table-export.js') }}"></script>
        {#        <link rel="stylesheet" href="{{ url_for('bower.static', filename='ng-table/dist/ng-table.css') }}">#}
    {% endif %}

    {% for script in js %}
        <script src=" {{ script }}"></script>
    {% endfor %}

    <script>

        var modules = checkModules([
            {% for dep in jsMods %}
                "{{ dep|safe}}",
            {% endfor %}
            {% if teacher_mode %}
                "ngTable", "ngTableExport"
            {% endif %}
        ]);

    </script>

    <script src="{{ url_for('bower.static', filename='ace-builds/src-min-noconflict/ace.js') }}"></script>
    <script src="{{ url_for('bower.static', filename='ace-builds/src-min-noconflict/ext-language_tools.js') }}"></script>
    <script src="{{ url_for('bower.static', filename='angular-ui-ace/ui-ace.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/view_html.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/pareditor.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/draggable.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/resizable.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/answerbrowser.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('bower.static', filename='katex-build/katex.min.css') }}">
    <script src="{{ url_for('static', filename='scripts/notesView/contents.js') }}"></script>
    <script src="{{ url_for('bower.static', filename='katex-build/katex.min.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/wallView/wallController.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/jsDatePick.full.1.3.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/createDialog.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/statisticsView/statisticsController.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/questionAnswerController.js') }}"></script>

    <!-- Script to load question from another file -->
    <script>
        $(function () {
            $("#question").load("../../question");
        });
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/popUp.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">


    {% if teacher_mode %}
        <script src="{{ url_for('static', filename='scripts/userlistController.js') }}"></script>
    {% endif %}

    {% for cssFile in cssFiles %}
        <link rel="stylesheet" href="{{ cssFile }}">
    {% endfor %}

    {% for cssFile in custom_css_files %}
        <link rel="stylesheet" href="{{ url_for('static', filename='css/' + cssFile + '.css') }}">
    {% endfor %}

    <style type="text/css">
        {{ custom_css }}
    </style>
    <script>
        var docId = JSON.parse({{docID|tojson|safe}});
        var docName = {{docName|tojson|safe}};
        var version = {{version|tojson|safe}};
        var rights = {{rights|tojson}};
        var startIndex = {{start_index|tojson}};
        var refererPath = {{request.path|tojson|safe}};
        var teacherMode = {{teacher_mode|tojson}};
        {% if teacher_mode %}
            var users = {{plugin_users|tojson}};
        {% else %}
            var users = [{{current_user|tojson}}];
        {% endif %}
    </script>

{% endblock %}
{% block content %}
    <div ng-app="timApp" class="paragraphs" ng-controller="ViewCtrl">
        <div ng-controller="WallController">
            {% include 'lectureinfo_menu.html' %}
            <div ng-show="!inLecture">
            </div>
            <div class="wall-behind" id="wall" ng-show="inLecture" tim-draggable-fixed="false" resizable>
                <div class="wall-base" id="wallBase">
                    <div class="wall-topbar" ng-mousedown="checkDown($event)" ng-mouseup="checkUp($event)">
                        Wall
                        <input type="button" ng-click="wallRelease($event)" id="detachButton" id="buttonRight">

                    </div>
                    <div ng-show="showWall" class="wall-content">
                        <div class="wall-message-area">
                            <textarea id="wallArea" readonly rows="20" cols="100">{{ "{{msg}}" }}</textarea>
                        </div>
                        <div class="wall-buttons">
                            <input id="messagebox" ng-model="newMsg" width="200" ng-keypress="chatEnterPressed($event)">
                            <!-- <button ng-click="sendMessageEvent(newMsg)">Send</button> -->
                            <!-- <input type="checkbox" ng-change="pollChanged()" ng-model="polling">Poll</button> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div id="contents" ng-show="indexTable.length > 0">
            <div class="menu">
                <img ng-click="toggleSidebar()" class="menu-icon"
                     src="{{ url_for('static', filename='images/contents.png') }}" width="50"
                     height="50"/>
            </div>
            <div ng-class="['sidebar', sidebarState]">
                {% raw %}
                <ul>
                    <li ng-repeat="entry in indexTable"
                        ng-class="entry.state"
                        ng-mouseup="entry.state = invertStateClearSelection($event, entry.state)">
                        <a class="indexentry" ng-class="entry.style" ng-click=""
                           href="{{entry.target}}">{{entry.text}}</a>
                        <ul ng-show="entry.state == 'exp'">
                            <li ng-repeat="subentry in entry.items">
                                <a ng-class="subentry.style" ng-click=""
                                   href="{{subentry.target}}">{{subentry.text}}</a>
                            </li>
                        </ul>
                    </li>
                </ul>
                {% endraw %}
            </div>
        </div>
        {% if teacher_mode %}
            <div ng-controller="UserListController" id="users" class="userlist" tim-draggable-fixed>
                {% if plugin_users %}
                    Users with answers ({{ plugin_users|length }}):<br>
                    {% raw %}
                    <table ng-table="tableParams" show-filter="true" class="table ng-table-rowselected"
                           export-csv="csv">
                        <tr ng-repeat="user in $data"
                            ng-click="user.$selected = !user.$selected; changeUser(user)"
                            ng-class="{'active': user.$selected}">
                            <td data-title="'Full name'" sortable="'real_name'" filter="{ 'real_name': 'text' }">
                                {{user.real_name}}
                            </td>
                            <td data-title="'User name'" sortable="'name'" filter="{ 'name': 'text' }">
                                {{user.name}}
                            </td>
                            <td data-title="'Tasks'" sortable="'task_count'" filter="{ 'task_count': 'text' }">
                                {{user.task_count}}
                            </td>
                            <td data-title="'Total points'" sortable="'total_points'"
                                filter="{ 'total_points': 'text' }">
                                {{user.total_points}}
                            </td>
                        </tr>
                    </table>
                    <a ng-mousedown="csv.generate()" ng-href="{{ csv.link() }}" download="users_{{ docId }}.csv">Export
                        to CSV</a>
                    {% endraw %}
                {% else %}
                    No answerers.
                {% endif %}
            </div>
        {% endif %}

        <div id="pars">
            {% for t in text %}
                <div class="par">
                    {% if 'task_id' in t %}
                        <answerbrowser
                                task-id="{{ t['task_id'] }}">
                        </answerbrowser>
                    {% endif %}
                    <div class="parContent">
                        {{ t['html']|safe }}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Adding question to view. Hidden until creation of question -->
        <question-dialog show='questionShown'>
            <div ng-controller="QuestionController">
                <ng-include src="'../../question'"></ng-include>
            </div>
        </question-dialog>
    </div>

{% endblock %}
