from timApp.tests.server.timroutetest import TimRouteTest


class MathTest(TimRouteTest):

    def test_svg_math(self):
        self.login_test1()
        d = self.create_doc(initial_par="$a+b$")
        d.document.set_settings({'math_type': 'svg'})
        self.assert_same_html(self.get(d.url, as_tree=True).cssselect('.parContent')[1], """
<div class="parContent">
    <p><span class="mathp inline">
        <img style="width:2.72618em; vertical-align:-0.15963em;"
             src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz4KPCEtLSBUaGlzIGZpbGUgd2FzIGdlbmVyYXRlZCBieSBkdmlzdmdtIDIuMS4zIC0tPgo8c3ZnIGhlaWdodD0nOC43NDg3MnB0JyB2ZXJzaW9uPScxLjEnIHZpZXdCb3g9Jy0wLjUwMDAwMiAtNy40MTg1IDIyLjcxODIgOC43NDg3Micgd2lkdGg9JzIyLjcxODJwdCcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayc+CjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbcGF0aCB7c3Ryb2tlOiBjdXJyZW50Q29sb3I7c3Ryb2tlLXdpZHRoOiAwLjA1cHQ7fV1dPjwvc3R5bGU+PHBhdGggZD0nTTMuNzE2MDYgLTMuNzY1ODhDMy41MzY3NCAtNC4xMzQ1IDMuMjQ3ODIgLTQuNDAzNDkgMi43OTk1IC00LjQwMzQ5QzEuNjMzODcgLTQuNDAzNDkgMC4zOTg1MDYgLTIuOTM4OTggMC4zOTg1MDYgLTEuNDg0NDNDMC4zOTg1MDYgLTAuNTQ3OTQ1IDAuOTQ2NDUxIDAuMTA5NTg5IDEuNzIzNTQgMC4xMDk1ODlDMS45MjI3OSAwLjEwOTU4OSAyLjQyMDkyIDAuMDY5NzM4NSAzLjAxODY4IC0wLjYzNzYwOUMzLjA5ODM4IC0wLjIxOTE3OCAzLjQ0NzA3IDAuMTA5NTg5IDMuOTI1MjggMC4xMDk1ODlDNC4yNzM5NyAwLjEwOTU4OSA0LjUwMzExIC0wLjExOTU1MiA0LjY2MjUyIC0wLjQzODM1NkM0LjgzMTg4IC0wLjc5NzAxMSA0Ljk2MTM5IC0xLjQwNDczIDQuOTYxMzkgLTEuNDI0NjZDNC45NjEzOSAtMS41MjQyOCA0Ljg3MTczIC0xLjUyNDI4IDQuODQxODQgLTEuNTI0MjhDNC43NDIyMiAtMS41MjQyOCA0LjczMjI1IC0xLjQ4NDQzIDQuNzAyMzcgLTEuMzQ0OTZDNC41MzMgLTAuNjk3Mzg1IDQuMzUzNjcgLTAuMTA5NTg5IDMuOTQ1MjEgLTAuMTA5NTg5QzMuNjc2MjEgLTAuMTA5NTg5IDMuNjQ2MzMgLTAuMzY4NjE4IDMuNjQ2MzMgLTAuNTY3ODdDMy42NDYzMyAtMC43ODcwNDkgMy42NjYyNSAtMC44NjY3NSAzLjc3NTg0IC0xLjMwNTExQzMuODg1NDMgLTEuNzIzNTQgMy45MDUzNSAtMS44MjMxNiAzLjk5NTAyIC0yLjIwMTc0TDQuMzUzNjcgLTMuNTk2NTFDNC40MjM0MSAtMy44NzU0NyA0LjQyMzQxIC0zLjg5NTM5IDQuNDIzNDEgLTMuOTM1MjRDNC40MjM0MSAtNC4xMDQ2MSA0LjMwMzg2IC00LjIwNDIzIDQuMTM0NSAtNC4yMDQyM0MzLjg5NTM5IC00LjIwNDIzIDMuNzQ1OTUgLTMuOTg1MDYgMy43MTYwNiAtMy43NjU4OFpNMy4wNjg0OSAtMS4xODU1NUMzLjAxODY4IC0xLjAwNjIzIDMuMDE4NjggLTAuOTg2MzAxIDIuODY5MjQgLTAuODE2OTM2QzIuNDMwODggLTAuMjY4OTkxIDIuMDIyNDIgLTAuMTA5NTg5IDEuNzQzNDYgLTAuMTA5NTg5QzEuMjQ1MzMgLTAuMTA5NTg5IDEuMTA1ODUgLTAuNjU3NTM0IDEuMTA1ODUgLTEuMDQ2MDhDMS4xMDU4NSAtMS41NDQyMSAxLjQyNDY2IC0yLjc2OTYxIDEuNjUzOCAtMy4yMjc5QzEuOTYyNjQgLTMuODE1NjkgMi40MTA5NiAtNC4xODQzMSAyLjgwOTQ2IC00LjE4NDMxQzMuNDU3MDQgLTQuMTg0MzEgMy41OTY1MSAtMy4zNjczNyAzLjU5NjUxIC0zLjMwNzZTMy41NzY1OSAtMy4xODgwNCAzLjU2NjYzIC0zLjEzODIzTDMuMDY4NDkgLTEuMTg1NTVaJyBpZD0nZzAtOTcnLz4KPHBhdGggZD0nTTIuMzgxMDcgLTYuODA0NDhDMi4zODEwNyAtNi44MTQ0NSAyLjM4MTA3IC02LjkxNDA3IDIuMjUxNTYgLTYuOTE0MDdDMi4wMjI0MiAtNi45MTQwNyAxLjI5NTE0IC02LjgzNDM3IDEuMDM2MTEgLTYuODE0NDVDMC45NTY0MTMgLTYuODA0NDggMC44NDY4MjQgLTYuNzk0NTIgMC44NDY4MjQgLTYuNjE1MTlDMC44NDY4MjQgLTYuNDk1NjQgMC45MzY0ODggLTYuNDk1NjQgMS4wODU5MyAtNi40OTU2NEMxLjU2NDEzIC02LjQ5NTY0IDEuNTg0MDYgLTYuNDI1OSAxLjU4NDA2IC02LjMyNjI4QzEuNTg0MDYgLTYuMjU2NTQgMS40OTQ0IC01LjkxNzgxIDEuNDQ0NTggLTUuNzA4NTlMMC42Mjc2NDYgLTIuNDYwNzdDMC41MDgwOTUgLTEuOTYyNjQgMC40NjgyNDQgLTEuODAzMjQgMC40NjgyNDQgLTEuNDU0NTVDMC40NjgyNDQgLTAuNTA4MDk1IDAuOTk2MjY0IDAuMTA5NTg5IDEuNzMzNSAwLjEwOTU4OUMyLjkwOTA5IDAuMTA5NTg5IDQuMTM0NSAtMS4zNzQ4NCA0LjEzNDUgLTIuODA5NDZDNC4xMzQ1IC0zLjcxNjA2IDMuNjA2NDggLTQuNDAzNDkgMi44MDk0NiAtNC40MDM0OUMyLjM1MTE4IC00LjQwMzQ5IDEuOTQyNzEgLTQuMTE0NTcgMS42NDM4NCAtMy44MDU3M0wyLjM4MTA3IC02LjgwNDQ4Wk0xLjQ0NDU4IC0zLjAzODYxQzEuNTA0MzYgLTMuMjU3NzggMS41MDQzNiAtMy4yNzc3MSAxLjU5NDAyIC0zLjM4NzNDMi4wODIxOSAtNC4wMzQ4NyAyLjUzMDUxIC00LjE4NDMxIDIuNzg5NTQgLTQuMTg0MzFDMy4xNDgxOSAtNC4xODQzMSAzLjQxNzE5IC0zLjg4NTQzIDMuNDE3MTkgLTMuMjQ3ODJDMy40MTcxOSAtMi42NjAwMiAzLjA4ODQyIC0xLjUxNDMyIDIuOTA5MDkgLTEuMTM1NzRDMi41ODAzMiAtMC40NjgyNDQgMi4xMjIwNCAtMC4xMDk1ODkgMS43MzM1IC0wLjEwOTU4OUMxLjM5NDc3IC0wLjEwOTU4OSAxLjA2NiAtMC4zNzg1OCAxLjA2NiAtMS4xMTU4MkMxLjA2NiAtMS4zMDUxMSAxLjA2NiAtMS40OTQ0IDEuMjI1NCAtMi4xMjIwNEwxLjQ0NDU4IC0zLjAzODYxWicgaWQ9J2cwLTk4Jy8+CjxwYXRoIGQ9J000LjA3NDcyIC0yLjI5MTQxSDYuODU0M0M2Ljk5Mzc3IC0yLjI5MTQxIDcuMTgzMDYgLTIuMjkxNDEgNy4xODMwNiAtMi40OTA2NlM2Ljk5Mzc3IC0yLjY4OTkxIDYuODU0MyAtMi42ODk5MUg0LjA3NDcyVi01LjQ3OTQ1QzQuMDc0NzIgLTUuNjE4OTMgNC4wNzQ3MiAtNS44MDgyMiAzLjg3NTQ3IC01LjgwODIyUzMuNjc2MjEgLTUuNjE4OTMgMy42NzYyMSAtNS40Nzk0NVYtMi42ODk5MUgwLjg4NjY3NUMwLjc0NzE5OCAtMi42ODk5MSAwLjU1NzkwOCAtMi42ODk5MSAwLjU1NzkwOCAtMi40OTA2NlMwLjc0NzE5OCAtMi4yOTE0MSAwLjg4NjY3NSAtMi4yOTE0MUgzLjY3NjIxVjAuNDk4MTMyQzMuNjc2MjEgMC42Mzc2MDkgMy42NzYyMSAwLjgyNjg5OSAzLjg3NTQ3IDAuODI2ODk5UzQuMDc0NzIgMC42Mzc2MDkgNC4wNzQ3MiAwLjQ5ODEzMlYtMi4yOTE0MVonIGlkPSdnMS00MycvPgo8L2RlZnM+CjxnIGlkPSdwYWdlMSc+Cjx1c2UgeD0nMCcgeGxpbms6aHJlZj0nI2cwLTk3JyB5PScwJy8+Cjx1c2UgeD0nNy40ODAwMicgeGxpbms6aHJlZj0nI2cxLTQzJyB5PScwJy8+Cjx1c2UgeD0nMTcuNDQyNicgeGxpbms6aHJlZj0nI2cwLTk4JyB5PScwJy8+CjwvZz4KPC9zdmc+"></span>
    </p>
</div>
""")

    def test_mathjax_math(self):
        self.login_test1()
        d = self.create_doc(initial_par="$a+b$")
        d.document.set_settings({'math_type': 'mathjax'})
        mathjax_html = """
<div class="parContent">
    <p><span class="math inline">\(a+b\)
        </span>
    </p>
</div>
"""
        self.assert_same_html(self.get(d.url, as_tree=True).cssselect('.parContent')[1], mathjax_html)
        d.document.set_settings({'math_type': 'xxx'})
        self.assert_same_html(self.get(d.url, as_tree=True).cssselect('.parContent')[1], mathjax_html)
        d.document.set_settings({'math_type': None})
        self.assert_same_html(self.get(d.url, as_tree=True).cssselect('.parContent')[1], mathjax_html)
