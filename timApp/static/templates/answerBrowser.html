<div class="answerBrowser" ng-cloak>
    <div uib-alert ng-repeat="alert in alerts" ng-class="'alert-' + (alert.type || 'warning')"
     data-close="closeAlert($index)"><div ng-bind-html="alert.msg"></div></div>
    <div class="row" ng-show="$parent.teacherMode && users.length > 0">
        <div class="col-xs-12">
            <div class="row">
                <div class="col-xs-5">
                    <div class="input-group input-group-xs">
                    <span class="input-group-btn">
                       <button class="btn btn-primary" ng-click="changeStudent(-1)">&uarr;</button>
                     </span>
                        <select class="form-control"
                                ng-model="user"
                                ng-options="(user.real_name + ' (' + user.name + ')') for user in users track by user.id"
                                ng-change="getAvailableAnswers()"></select>
                        <span class="input-group-btn">
                     <button class="btn btn-primary" ng-click="changeStudent(+1)">&darr;</button>
                     <button class="btn btn-primary" ng-click="randomStudent()" title="Choose random student">R</button>
                    </span>
                    </div>
                </div>
                <div class="col-xs-7">
                    <span class="nudge-left-25">
                        {{ findSelectedUserIndex() + 1 }}/{{ users.length }}
                    </span>
                    <a ng-href="mailto:{{user.email}}">email</a>
                </div>
            </div>
        </div>
    </div>
    <div ng-show="!hasUserChanged() || loading">
        <div ng-show="answers.length > 0">
            <div class="row">
                <div class="col-xs-5">
                    <div class="input-group input-group-xs">
                <span class="input-group-btn">
                    <button class="btn btn-primary prevAnswer" ng-click="previousAnswer()">&larr;</button>
                </span>
                        <select class="form-control" ng-model="selectedAnswer"
                                ng-options="((filteredAnswers.length - idx) + '. ' + (answer.answered_on | timdate )) for (idx, answer) in filteredAnswers | orderBy:'answer.id' track by answer.id"
                                ng-change="changeAnswer()"></select>
                <span class="input-group-btn">
                    <button class="btn btn-primary nextAnswer" ng-click="nextAnswer()">&rarr;</button>
                </span>
                    </div>
                </div>
                <div class="col-xs-7">
                    <span class="nudge-left-25">{{ filteredAnswers.length - findSelectedAnswerIndex() }}/<a
                            ng-click="setNewest()">{{ filteredAnswers.length }}</a></span>
                    <label class="checkbox-inline" ng-show="anyInvalid">
                        <input type="checkbox" ng-model="onlyValid">Show valid only</label>
                    <span ng-show="showTeacher()"> | <a ng-click="getAllAnswers()">All answers</a></span>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <form ng-submit="savePoints()" class="point-form form-inline">
                        <label ng-show="showTeacher() || (giveCustomPoints && allowCustomPoints())">
                        Points:<input class="form-control input-xs"
                                      focus-me="shouldFocus"
                                      ng-focus="shouldFocus = true"
                                      ng-blur="shouldFocus = false"
                                      ng-model="points"
                                      name="points"
                                      type="text"
                                      autocomplete="off"
                                      size="2">
                        </label>
                        <button title="Save points"
                                class="timButton btn-xs"
                                ng-show="points != selectedAnswer.points">
                            <i class="glyphicon glyphicon-ok"></i>
                        </button>
                    </form>
                    <span ng-show="points !== null && !(showTeacher() || (giveCustomPoints && allowCustomPoints())) && taskInfo.pointsText">{{ taskInfo.pointsText }} {{ points }}</span>
                    <span ng-show="taskInfo.maxPoints && points !== null">/ {{ taskInfo.maxPoints }}</span>
                    <span ng-show="!selectedAnswer.valid && points !== null">(invalid)</span>
                    <span ng-show="!$parent.teacherMode && allowCustomPoints()">
                        <label class="checkbox-inline">
                            <input type="checkbox"
                                   ng-model="giveCustomPoints">Set custom points</label>
                    </span>
                    <label class="checkbox-inline" ng-show="$parent.teacherMode && allowCustomPoints()">
                        <input type="checkbox" ng-model="giveCustomPoints">cp
                    </label>
                    <label class="checkbox-inline" ng-show="showTeacher()">
                        <input type="checkbox" ng-model="saveTeacher">Save teacher's fix
                    </label>
                    <label class="checkbox-inline" ng-show="showVelpsCheckBox()">
                        <input type="checkbox" ng-model="review">Velps
                    </label>
                </div>
            </div>
            <div class="row" ng-show="selectedAnswer.collaborators.length > 1">
                <div class="col-xs-12">
                    Collaborators:
                    <ul>
                        <li ng-repeat="c in selectedAnswer.collaborators"><a ng-href="mailto:{{c.email}}">{{ c.real_name }}</a></li>
                    </ul>
                </div>
            </div>
            <div ng-show="review" class="review">

            </div>
        </div>
        <span class="triesLeft" ng-show="taskInfo.answerLimit && taskInfo.triesText">{{ taskInfo.triesText }} {{ getTriesLeft() }}</span>
        <span ng-show="answers.length == 0 && $parent.teacherMode">(no answers)</span>
    </div>
    <span ng-show="taskInfo.starttime || taskInfo.deadline">
        Answering time:
        <span ng-show="taskInfo.starttime && !taskInfo.deadline">
            Since {{ taskInfo.starttime | timdate }}
        </span>
        <span ng-show="!taskInfo.starttime && taskInfo.deadline">
            Until {{ taskInfo.deadline | timdate }}
        </span>
        <span ng-show="taskInfo.starttime && taskInfo.deadline">
            {{ taskInfo.starttime | timdate }} - {{ taskInfo.deadline | timdate }}
        </span>
    </span>
    <span ng-show="$parent.teacherMode && hasUserChanged() && !firstLoad && !loading">(hover/click to update)</span>
    <!-- <img style="display: inline" src="/static/images/loading.gif" ng-show="loading"> -->
</div>
