<div class="velpMenu" tim-draggable-fixed="" caption="Velp menu">



    <uib-tabset active="active">
        <uib-tab index="0" heading="Select velp">
            <br />
            <label><input type="checkbox" ng-model="advancedOn"> Advanced view</label>
            <div class="velpArea">

                <!-- LABELS -->
                <div id="labels" ng-show="advancedOn">
                <table class="velpTable">
                    <tr>
                        <td>
                            <label for="searchLabels">Filter labels </label>
                        </td>
                        <td>
                            <input id="searchLabels" ng-model="filterLabel" placeholder="filter labels">
                        </td>
                    </tr>
                </table>
                <!--   <tr>
                       <td colspan="4">-->
                <div>
                    <div class="fulldiv">
                        <p ng-repeat="label in filteredLabels = ( labels | filter:{content:filterLabel} )"
                           class="label tag-false"
                           ng-style="{ backgroundColor: getColor(label.id) };"
                           ng-click="toggleLabel(label)" ng-model="test" value="{{ label.id }}">
                            {{ label.content }} <span class="glyphicon glyphicon-ok" ng-show="label.selected"></span>
                        </p><!-- p ng-click="selectLabelToEdit()" ng-class="['label', 'tag-false']" style="background: blue;">
                                <span class="glyphicon glyphicon-plus"></span> Add label
                            </p -->
                        <hr />
                    </div>

                </div>
                    </div>
                <!--    </td>
                </tr>-->
                <table class="velpTable">
                    <tr>
                        <td>
                            <label for="searchVelps">Search velps:</label>
                        </td>
                        <td>
                            <input id="searchVelps" ng-model="filterVelp" placeholder="Filter velps">
                        </td>
                    </tr>
                    <tr ng-show="advancedOn">
                        <td>
                            <label for="orderVelps">Order velps:</label>
                        </td>
                        <td><select id="orderVelps" ng-model="orderVelp">
                            <option value="content">Alphabetical</option>
                            <option value="-used">Most used</option>
                            <option value="label">Labels</option>
                            <option value="-points">Highest point</option>
                            <option value="points">Lowest point</option>
                        </select>
                        </td>
                    </tr>
                </table>

                <input type="button" ng-click="selectVelpToEdit(newVelp)" value="Create velp">

                <div class="stack">

                    <!-- NEW VELP -->
                    <div ng-model="newVelp" class="velp" ng-style="{top: 0}" ng-hide="!newVelp.edit">
                        <div ng-class="['emphasise', 'new', { neutral: newVelp.points == 0, positive: newVelp.points > 0, negative: newVelp.points < 0,
                            edit: newVelp.edit}]">
                            <div ng-class="['content']">
                                <p ng-hide="newVelp.edit">
                                <span>Add velp!&ensp;</span>
                                <span class="points">{{ newVelp.points }}</span>
                                </p>
                                <form ng-class="[{hide: !newVelp.edit}]" name="addVelpForm"
                                ng-submit="addVelp(addVelpForm)" novalidate>

                                            <p><input name="velpName" type="text"
                                                   ng-model="newVelp['content']"
                                                   required placeholder="Add velp!" autofocus>
                                            <span ng-class="['glyphicon', 'glyphicon-tag', {hide: !advancedOn}]"
                                                  ng-repeat="label in newVelp.labels"
                                                  ng-style="{ color: getColor(label) }"></span></p>

                                    <p class="error" ng-show="(addVelpForm.velpName.$invalid && !addVelpForm.velpName.$pristine) || (submitted && addVelpForm.velpName.$invalid)">
                                        Velp content is required
                                    </p>

                                    <p><input id="addVelpPoints" type="number" ng-model="newVelp['points']" style="width: 100%;"
                                              placeholder="Points" value="0"></p>


                                        <fieldset ng-show="advancedOn">
                                            <legend>Labels</legend>
                                                    <span ng-repeat="l in labels">
                                                        <label><input type="checkbox" ng-click="updateVelpLabels(newVelp, l)"
                                                               ng-checked="isLabelInVelp(newVelp, l)"> {{ l.content }}</label><br>
                                                    </span>
                                        <input placeholder="Add label" ng-model="newLabel['content']">
                                        <input type="button" value="Add" ng-click="addLabel(newVelp)">
                                        <span ng-hide="newLabel['valid']" class="error">Label content too short</span>
                                    </fieldset>



                                    <fieldset ng-show="advancedOn">
                                        <legend>Velpgroups</legend>
                                        <span ng-repeat="gr in velpGroups">
                                            <label><input type="checkbox"
                                                          ng-click="updateVelpGroups(newVelp, gr)"
                                                          ng-checked="gr.default"> {{ gr.name }}</label><br>
                                        </span>
                                    </fieldset>
                   
                                    <p><input type="submit" value="Add velp"/></p>

                                </form>


                                    </div>
                                    </div>
                                </div>

                            <!-- EDIT VELPS -->
                            <span ng-repeat="velp in filteredVelps = (velps | filter:{content:filterVelp} | orderBy:orderVelp | filterByVelpGroups:velpGroups | filterByLabels:labels:advancedOn )">

                                <div class="velp"  ng-click="useVelp(velp)"
                                     ng-style="{top: 2+$index*2 + 'em'}">
                                    <div ng-class="['velp-data', 'emphasise', {neutral: velp.points == 0, positive: velp.points > 0, negative: velp.points < 0,
                                    edit: velp.edit}]">

                                        <div ng-class="['content']">
                                            <div ng-hide="velp.edit">
                                                <p ng-hide=>
                                                    <span>{{ velp.content }}&ensp;</span>
                                                    <span class="points">{{ velp.points }}</span>
                                                    <span ng-show="advancedOn" ng-class="['glyphicon', 'glyphicon-tag']"
                                                          ng-repeat="label in velp.labels" title="label.content"
                                                          ng-style="{ color: getColor(label) }"></span>
                                                    <span class="float-right" ng-click="selectVelpToEdit(velp)"
                                                          ng-class="['glyphicon', 'glyphicon-pencil', 'clickable-icon']"></span>

                                                </p>
                                                <!-- Adds post-it style to the bottom of velp -->
                                                <div class="bottom-part"></div>
                                            </div>
                                            <!-- Edit Velp -->
                                            <form ng-class="[{hide: !velp.edit}]" name="editVelpForm"
                                                  ng-submit="editVelp(editVelpForm)" novalidate>

                                                <p><input name="velpName" type="text"
                                                          ng-model="velpToEdit['content']"
                                                          required placeholder="Edit velp!">
                                            <span ng-class="['glyphicon', 'glyphicon-tag', {hide: !advancedOn}]"
                                                  ng-repeat="l in velpToEdit.labels"
                                                  ng-style="{ color: getColor(l) }"></span>
                                                    <span class="float-right" ng-click="selectVelpToEdit(velp)"
                                                          ng-class="['glyphicon', 'glyphicon-pencil', 'clickable-icon']"></span>
                                                </p>

                                                <p ng-show="(editVelpForm.velpName.$invalid && !editVelpForm.velpName.$pristine) || (submitted && editVelpForm.velpName.$invalid)" class="error">
                                                    Velp content is required
                                                </p>
                                                <p><input id="addVelpPoints" type="number" style="width: 100%;"
                                                          ng-model="velpToEdit['points']"
                                                          placeholder="Points" value="0"></p>

                                                    <fieldset ng-show="advancedOn">
                                                <legend>Labels</legend>

                                                    <span ng-repeat="l in labels">
                                                        <span ng-show="!l.edit">
                                                        <label><input type="checkbox"
                                                                      ng-click="updateVelpLabels(velpToEdit, l)"
                                                                      ng-checked="isLabelInVelp(velpToEdit, l)"> {{ l.content }}
                                                        </label>
                                                        <span class="float-right" ng-click="selectLabelToEdit(l)"
                                                              ng-class="['glyphicon', 'glyphicon-pencil', 'clickable-icon']"></span>
                                                        <br>
                                                        </span>
                                                        <span ng-show="l.edit">
                                                            <input type="text" placeholder="Label name" ng-model="labelToEdit.content">
                                                            <span class="float-right" ng-click="selectLabelToEdit(l)"
                                                              ng-class="['glyphicon', 'glyphicon-pencil', 'clickable-icon']"></span>
                                                            <input type="button" value="Save" ng-click="editLabel(labelToEdit)"> <input type="button" value="Cancel" ng-click="selectLabelToEdit(l)">
                                                            <br>
                                                        </span>
                                                    </span>
                                                    <input placeholder="Add label" ng-model="newLabel['content']">
                                                    <input type="button" value="Add" ng-click="addLabel(velpToEdit)">
                                                    <span ng-hide="newLabel['valid']" class="error">Label content too short</span>
                                                </fieldset>


                                                <fieldset ng-show="advancedOn">
                                                <legend>Velpgroups</legend>
                                                    <span ng-repeat="g in velpGroups">
                                                        <label><input type="checkbox"
                                                                      ng-click="updateVelpGroups(velpToEdit, g)"
                                                                      ng-checked="isGroupInVelp(velpToEdit, g)"> {{ g.name }}</label><br>
                                                    </span>
                                                </fieldset>

                                                <p><input type="submit" value="Save changes"/> <input type="button" value="Cancel" ng-click="selectVelpToEdit(velp)"></p>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- div ng-class="['emphasise', {neutral: velp.points == 0, positive: velp.points > 0, negative: velp.points < 0}]" style="height: 2px;"></div -->
                            </span>
                    </div>
                    <!--p ng-hide="filteredVelps.length">No velps :'(</p -->
                </div>
                <!--  </td>
              </tr>-->

        </uib-tab>

        <!-- MANAGE VELPS -->
        <uib-tab index="1" heading="Manage velps">

            <div class="velpArea">
                <div class="velpSummary">
                    <!-- table class="velpTable">
                        <tr>
                            <td>
                                <label>Search velp groups</label>
                            </td>
                            <td>
                                <input placeholder="Enter text...">
                            </td>
                        </tr>
                    </table -->

                    <table class="fulldiv">
                        <tr>
                            <th>Show</th>
                            <th>Group name</th>
                        </tr>
                        <tr ng-repeat="group in velpGroups">
                            <td>
                                <input type="checkbox" ng-model="group.selected" ng-click="changeVelpGroupSelection(group)">
                            </td>
                            <td>
                                <a ng-href="/velp/{{group.location}}">{{ group.name }}</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </uib-tab>

        <!-- SUMMARY -->
        <uib-tab index="2" heading="Summary">
            <div velp-summary="" annotations="annotations"></div>
        </uib-tab>
    </uib-tabset>
</div>